{"mappings":"gfAAA,IAAAA,EAAAC,EAAA,S,uCAMA,IAAIC,EAAQF,EAAAG,QAAOC,QAEfC,EAAO,EAEX,IAAIC,EAEJ,MAAMC,EAAO,CACXC,QAASC,SAASC,cAAc,YAChCC,WAAYF,SAASC,cAAc,gBACnCE,SAAUH,SAASC,cAAc,cACjCG,aAAcJ,SAASC,cAAc,oBAavC,SAASI,EAAkBC,GACzB,MAAMC,EAASD,EAAIE,cACfD,IAAaT,EAAKI,YAAgBT,IAAUF,EAAAG,QAAOC,SACpDY,IAAYT,EAAKK,UAAcV,IAAUF,EAAAG,QAAOe,QAInDb,EAAO,EAEHW,IAAWT,EAAKI,YAClBT,EAAQF,EAAAG,QAAOC,QACfG,EAAKI,WAAWQ,UAAUC,IAAI,aAC9Bb,EAAKK,SAASO,UAAUE,OAAO,cACtBL,IAAWT,EAAKK,WACzBV,EAAQF,EAAAG,QAAOe,MACfX,EAAKI,WAAWQ,UAAUE,OAAO,aACjCd,EAAKK,SAASO,UAAUC,IAAI,cAG9BlB,EAAMoB,gBACNC,I,CA9BEC,OAAOC,OAAOlB,GAAMmB,MAAKC,IAAOA,KAClCC,QAAQC,MAAM,0BAGhBtB,EAAKC,QAAQsB,mBAAmB,WAAY,gCAC5CvB,EAAKwB,SAAWtB,SAASC,cAAc,aAEvCH,EAAKI,WAAWqB,iBAAiB,QAASlB,GAC1CP,EAAKK,SAASoB,iBAAiB,QAASlB,GAyBxC,MAiBMmB,EAAW,IAAIC,sBAXH,CAACC,EAASC,KAC1BD,EAAQE,SAAQC,IACVA,EAAMC,gBACJlC,EAAOH,EAAMsC,cApDN,KAqDTnC,GAAQ,EACRkB,I,GAGJ,GAdiB,CACnBkB,KAAM,KACNC,WAAY,QACZC,UAAW,IAgBb,SAASpB,IAEM,IAATlB,IACEH,EAAM0C,WAAa,EACrBrC,EAAKC,QAAQqC,UAAY,GAEzBtC,EAAKC,QAAQqC,UAAY,qDAI7B,MAAMC,EAAS5C,EAAM6C,cAAc1C,EAxEpB,GA0EfE,EAAKC,QAAQsB,mBAAmB,YASlC,SAA6BgB,GAC3B,OAAOA,EAAOE,KAAIC,IAAS,EAAAC,EAAA/C,SAAqB8C,KAAQE,KAAK,G,CAVhBC,CAAoBN,IAEnD,IAAVzC,GAAiBH,EAAMsC,cA5EZ,GA4EsC,EACnDP,EAASoB,QAAQ9C,EAAKwB,UACb1B,IAASH,EAAMsC,cA9EX,IA+EbP,EAASqB,UAAU/C,EAAKwB,S,CAqC5B,SAASwB,IACHrD,EAAM0C,aAAetC,IACvBD,EAAO,EACPkB,IACAjB,EAAYJ,EAAM0C,W,CAjCtBrB,IAIAhB,EAAKC,QAAQwB,iBAAiB,SAE9B,SAAwBjB,GAEtBA,EAAIyC,iBAEJ,MAAMC,EAAW1C,EAAI2C,OAAOC,QAAQ,SACpC,IAAKF,EACH,OAEF,MAAMG,EAASH,EAASI,QAAQC,OAE1Bb,EAAQ/C,EAAM6D,aAAaH,GACjC,IAAKX,EAEH,YADArB,QAAQC,MAAM,mBAAmB+B,6BAInCtD,EAAYJ,EAAM0C,WAElBrC,EAAKM,aAAagC,WAAY,EAAAmB,EAAA7D,SAAkB8C,IAEhD,EAAAgB,EAAAC,gBAAeX,E","sources":["src/js/library.js"],"sourcesContent":["import myLibs from './library-service';\nimport createFilmCardMarkup from './film-card';\nimport createModalMarkup from './modal-film';\n\nimport { openMovieModal } from './library-modal';\n\nlet myLib = myLibs.watched;\n\nlet page = 1;\nconst per_page = 9;   \nlet prevCount;\n\nconst refs = {\n  gallery: document.querySelector('.gallery'),\n  btnWatched: document.querySelector('#btn-watched'),\n  btnQueue: document.querySelector('#btn-queue'),\n  modalContent: document.querySelector(\".modal__content\"),\n};\n\nif (Object.values(refs).some(el => !el)) {\n  console.error('Error: invalid markup!');\n}\n\nrefs.gallery.insertAdjacentHTML('afterend', `<div class=\"js-guard\"></div>`);\nrefs.guardDiv = document.querySelector('.js-guard');\n\nrefs.btnWatched.addEventListener('click', onBtnLibraryClick);\nrefs.btnQueue.addEventListener('click', onBtnLibraryClick);\n\nfunction onBtnLibraryClick(evt) {\n  const curBtn = evt.currentTarget;\n  if (((curBtn === refs.btnWatched) && (myLib === myLibs.watched)) ||\n    ((curBtn === refs.btnQueue) && (myLib === myLibs.queue))) {\n    return;\n  }\n\n  page = 1;\n\n  if (curBtn === refs.btnWatched) {\n    myLib = myLibs.watched;\n    refs.btnWatched.classList.add('is-active');\n    refs.btnQueue.classList.remove('is-active');\n  } else if (curBtn === refs.btnQueue) {\n    myLib = myLibs.queue;\n    refs.btnWatched.classList.remove('is-active');\n    refs.btnQueue.classList.add('is-active');\n  }\n\n  myLib.refreshMovies();\n  showLibrary();\n}\n\nconst observerOpts = {\n  root: null,\n  rootMargin: '300px',\n  threshold: 1.0,\n};\n\nconst onObserve = (entries, observer) => {\n  entries.forEach(entry => {\n    if (entry.isIntersecting) {\n      if (page < myLib.getCountPages(per_page)) {\n        page += 1;\n        showLibrary();\n      }\n    }\n  });\n};\n\nconst observer = new IntersectionObserver(onObserve, observerOpts);\n\nfunction showLibrary() {\n\n  if (page === 1) {   \n    if (myLib.getCount() > 0) {\n      refs.gallery.innerHTML = '';\n    } else {  \n      refs.gallery.innerHTML = `<li class=\"gallery_pin\">The library is empty</li>`;\n    } \n  }\n\n  const movies = myLib.getMoviesPage(page, per_page);\n\n  refs.gallery.insertAdjacentHTML('beforeend', createGalleryMarkup(movies));\n\n  if ((page === 1) && (myLib.getCountPages(per_page) > 1)) {\n    observer.observe(refs.guardDiv);\n  } else if (page === myLib.getCountPages(per_page)) {\n    observer.unobserve(refs.guardDiv);\n  }\n}\n\nfunction createGalleryMarkup(movies) {\n  return movies.map(movie => createFilmCardMarkup(movie)).join('');\n}\n\nshowLibrary();\n\n// ----------  MODAL  ----------\n\nrefs.gallery.addEventListener(\"click\", onGalleryClick);\n\nfunction onGalleryClick(evt) {\n\n  evt.preventDefault();\n\n  const filmCard = evt.target.closest('.card');\n  if (!filmCard) {\n    return;\n  }\n  const filmId = filmCard.dataset.filmid;\n\n  const movie = myLib.getMovieById(filmId);\n  if (!movie) {\n    console.error(`Movie with id = ${filmId} isn't found in library!`);\n    return;\n  }\n\n  prevCount = myLib.getCount();\n\n  refs.modalContent.innerHTML = createModalMarkup(movie);\n\n  openMovieModal(onAfterModalClose);\n}\n\nfunction onAfterModalClose() { \n  if (myLib.getCount() !== prevCount) {\n    page = 1;\n    showLibrary();\n    prevCount = myLib.getCount();\n  }\n}\n"],"names":["$54T7b","parcelRequire","$93effc6fc56091ad$var$myLib","default","watched","$93effc6fc56091ad$var$page","$93effc6fc56091ad$var$prevCount","$93effc6fc56091ad$var$refs","gallery","document","querySelector","btnWatched","btnQueue","modalContent","$93effc6fc56091ad$var$onBtnLibraryClick","evt","curBtn","currentTarget","queue","classList","add","remove","refreshMovies","$93effc6fc56091ad$var$showLibrary","Object","values","some","el","console","error","insertAdjacentHTML","guardDiv","addEventListener","$93effc6fc56091ad$var$observer","IntersectionObserver","entries","observer","forEach","entry","isIntersecting","getCountPages","root","rootMargin","threshold","getCount","innerHTML","movies","getMoviesPage","map","movie","$b3pWk","join","$93effc6fc56091ad$var$createGalleryMarkup","observe","unobserve","$93effc6fc56091ad$var$onAfterModalClose","preventDefault","filmCard","target","closest","filmId","dataset","filmid","getMovieById","$73ES2","$kWfXz","openMovieModal"],"version":3,"file":"library.2c03a094.js.map"}