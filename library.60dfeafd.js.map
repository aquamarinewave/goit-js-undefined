{"mappings":"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","sources":["src/js/library.js","src/js/film-card.js"],"sourcesContent":["import myLibs from './library-service';\nimport createFilmCardMarkup from './film-card';\nimport createModalMarkup from './modal-film';\n\nimport { initModal } from './library-modal';\n\nlet myLib = myLibs.watched;\n\nlet page = 1;\nconst per_page = 6;   // !?! установить коррект\n\nconst refs = {\n  gallery:    document.querySelector('.gallery'),\n  btnWatched: document.querySelector('#btn-watched'),\n  btnQueue: document.querySelector('#btn-queue'),\n  overlay: document.querySelector('.overlay'),\n  btnModalClose: document.querySelector(\".modal__button-cls\"),\n  modalContent: document.querySelector(\".modal__content\"),\n};\n\nif (Object.values(refs).some(el => !el)) {\n  console.error('Error: invalid markup!');\n}\n\nrefs.gallery.insertAdjacentHTML('afterend', `<div class=\"js-guard\"></div>`); \nrefs.guardDiv = document.querySelector('.js-guard');\n\nrefs.btnWatched.addEventListener('click', onBtnLibraryClick);\nrefs.btnQueue.addEventListener('click', onBtnLibraryClick);\n\nfunction onBtnLibraryClick(evt) {\n  const curBtn = evt.currentTarget;\n  if (((curBtn === refs.btnWatched) && (myLib === myLibs.watched)) ||\n      ((curBtn === refs.btnQueue) && (myLib === myLibs.queue))) {\n    return;\n  }\n\n  page = 1;\n\n  if (curBtn === refs.btnWatched) {\n    myLib = myLibs.watched;\n    refs.btnWatched.classList.add('is-active');\n    refs.btnQueue.classList.remove('is-active');\n  } else if (curBtn === refs.btnQueue) {\n    myLib = myLibs.queue;\n    refs.btnWatched.classList.remove('is-active');\n    refs.btnQueue.classList.add('is-active');\n  }\n\n  myLib.refreshMovies();\n  showLibrary();\n}\n\nconst observerOpts = {\n  root: null,\n  rootMargin: '300px',\n  threshold: 1.0\n}\n\nconst onObserve = (entries, observer) => {\n  entries.forEach(entry => {\n    if (entry.isIntersecting) {\n      if (page < myLib.getCountPages(per_page)) {\n        page += 1;\n        showLibrary();  \n      }\n    }\n  });\n}\n\nconst observer = new IntersectionObserver(onObserve, observerOpts);\n\nfunction showLibrary() {\n\n  //if ((page === 1) && (myLib.getCount() > 0)) {   // !?! - для заглушки пустой библиотеки\n  if (page === 1) {\n    refs.gallery.innerHTML = '';\n  }\n\n  const movies = myLib.getMoviesPage(page, per_page); \n\n  refs.gallery.insertAdjacentHTML('beforeend', createGalleryMarkup(movies));\n\n  if ((page === 1) && (myLib.getCountPages(per_page) > 1)) {\n    observer.observe(refs.guardDiv);\n  } else if (page === myLib.getCountPages(per_page)) {\n    observer.unobserve(refs.guardDiv);\n  }\n}\n\nfunction createGalleryMarkup(movies) {\n  return movies.map(movie => createFilmCardMarkup(movie)).join('');\n}\n\nshowLibrary();\n\n// ----------  MODAL  ----------\n\nrefs.btnModalClose.addEventListener(\"click\", onModalClose);\nrefs.gallery.addEventListener(\"click\", onGalleryClick);\n\nfunction onGalleryClick(evt) {\n\n  evt.preventDefault(); \n  \n  const filmCard = evt.target.closest(\".card\");\n  if (!filmCard) {\n    return;  \n  }\n  const filmId = filmCard.dataset.filmid;\n\n  const movie = myLib.getMovieById(filmId);\n  if (!movie) {\n    console.error(`Movie with id = ${filmId} isn't found in library!`);\n    return;\n  }\n    \n  refs.modalContent.innerHTML = createModalMarkup(movie);\n\n  initModal();\n\n  refs.overlay.classList.remove('visually-hidden');\n  document.body.classList.add(\"modal__is-open\");\n  document.addEventListener('keydown', onKeyDown);\n  refs.overlay.addEventListener(\"click\", onBackdropClick);\n}\n\nfunction onModalClose() {\n  refs.overlay.classList.add(\"visually-hidden\");\n  document.body.classList.remove(\"modal__is-open\");\n\n  page = 1;\n  showLibrary();\n}\n\nfunction onKeyDown(evt) {\n    if (evt.key === \"Escape\") {\n        onModalClose();\n        document.removeEventListener(\"keydown\", onKeyDown);\n    }\n} \n\nfunction onBackdropClick(evt) {\n    if (evt.currentTarget === evt.target) {\n        onModalClose();\n        refs.overlay.removeEventListener(\"click\", onBackdropClick);\n    }\n}","export default\nfunction createFilmCardMarkup({id, posterURL = '', title = '', genres = 'no info', year = 'no info', votes = '' }) {\n  return ` \n    <div class=\"card\" data-filmid=\"${id}\">\n        <img src=\"${posterURL}\" alt=\"${title}\" class=\"card__pic\">\n        <div class=\"card__information\">\n            <p class=\"card__film-name\">${title}</p>\n            <div class=\"card__additional-information\">\n                <ul class=\"card__gener-list\">\n                    <li class=\"card__gener-item\">${genres}</li>\n                </ul>\n                <div class=\"card__vl\"></div>\n                <p class=\"card__release-year\">${year}</p>\n            </div>\n        </div>\n    </div>\n  `;\n}    \n"],"names":["$54T7b","parcelRequire","$80c4189e6cc88ea4$export$2e2bcd8739ae039","id","posterURL","title","genres","year","votes","$93effc6fc56091ad$var$myLib","default","watched","$93effc6fc56091ad$var$page","$93effc6fc56091ad$var$refs","gallery","document","querySelector","btnWatched","btnQueue","overlay","btnModalClose","modalContent","$93effc6fc56091ad$var$onBtnLibraryClick","evt","curBtn","currentTarget","queue","classList","add","remove","refreshMovies","$93effc6fc56091ad$var$showLibrary","Object","values","some","el","console","error","insertAdjacentHTML","guardDiv","addEventListener","$93effc6fc56091ad$var$observer","IntersectionObserver","entries","observer","forEach","entry","isIntersecting","getCountPages","root","rootMargin","threshold","innerHTML","movies","getMoviesPage","map","movie","join","$93effc6fc56091ad$var$createGalleryMarkup","observe","unobserve","$93effc6fc56091ad$var$onModalClose","body","$93effc6fc56091ad$var$onKeyDown","key","removeEventListener","$93effc6fc56091ad$var$onBackdropClick","target","preventDefault","filmCard","closest","filmId","dataset","filmid","getMovieById","$73ES2","$kWfXz","initModal"],"version":3,"file":"library.60dfeafd.js.map"}