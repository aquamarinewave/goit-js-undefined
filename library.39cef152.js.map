{"mappings":"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","sources":["src/js/library.js","src/js/film-card.js"],"sourcesContent":["import myLibs from './library-service';\nimport createFilmCardMarkup from './film-card';\n\nlet myLib = myLibs.watched;\n\nlet page = 1;\nconst per_page = 6;   // !?! установить коррект\n\nconst refs = {\n  gallery:    document.querySelector('.gallery'),\n  btnWatched: document.querySelector('#btn-watched'),\n  btnQueue:   document.querySelector('#btn-queue'),\n};\n\nif (Object.values(refs).some(el => !el)) {\n  throw new Error('Invalid markup!');\n}\n\nrefs.gallery.insertAdjacentHTML('afterend', `<div class=\"js-guard\"></div>`); \nrefs.guardDiv = document.querySelector('.js-guard');\n\nrefs.btnWatched.addEventListener('click', onBtnLibraryClick);\nrefs.btnQueue.addEventListener('click', onBtnLibraryClick);\n\nfunction onBtnLibraryClick(evt) {\n  const curBtn = evt.currentTarget;\n  if (((curBtn === refs.btnWatched) && (myLib === myLibs.watched)) ||\n      ((curBtn === refs.btnQueue) && (myLib === myLibs.queue))) {\n    return;\n  }\n\n  page = 1;\n\n  if (curBtn === refs.btnWatched) {\n    myLib = myLibs.watched;\n    refs.btnWatched.classList.add('is-active');\n    refs.btnQueue.classList.remove('is-active');\n  } else if (curBtn === refs.btnQueue) {\n    myLib = myLibs.queue;\n    refs.btnWatched.classList.remove('is-active');\n    refs.btnQueue.classList.add('is-active');\n  }\n\n  myLib.refreshMovies();\n  showLibrary();\n}\n\nconst observerOpts = {\n  root: null,\n  rootMargin: '300px',\n  threshold: 1.0\n}\n\nconst onObserve = (entries, observer) => {\n  entries.forEach(entry => {\n    if (entry.isIntersecting) {\n      if (page < myLib.getCountPages(per_page)) {\n        page += 1;\n        showLibrary();  \n      }\n    }\n  });\n}\n\nconst observer = new IntersectionObserver(onObserve, observerOpts);\n\nfunction showLibrary() {\n\n  if ((page === 1) && (myLib.getCount() > 0)) {\n    refs.gallery.innerHTML = '';\n  }\n\n  const movies = myLib.getMoviesPage(page, per_page); \n\n  refs.gallery.insertAdjacentHTML('beforeend', createGalleryMarkup(movies));\n\n  if ((page === 1) && (myLib.getCountPages(per_page) > 1)) {\n    observer.observe(refs.guardDiv);\n  } else if (page === myLib.getCountPages(per_page)) {\n    observer.unobserve(refs.guardDiv);\n  }\n}\n\nfunction createGalleryMarkup(movies) {\n  return movies.map(movie => createFilmCardMarkup(movie)).join('');\n}\n\nshowLibrary();\n\n// ---------  LIBRARY IN MODAL  -----------\n\nconst refsM = {\n  btnWatched: document.querySelector('.modal__button--watched'),\n  btnQueue:   document.querySelector('.modal__button--queue'),\n  infoId:     document.querySelector('.modal__information'),\n  title:      document.querySelector('.modal__title'),\n  poster:     document.querySelector('.modal__image'),\n  overview:   document.querySelector('.modal__text'),\n};\n\nif (Object.values(refsM).some(el => !el)) {\n  throw new Error('Invalid markup of modal window!');\n}\n\nrefsM.btnWatched.addEventListener('click', onModalLibraryClick.bind(null, \"watched\"));\nrefsM.btnQueue.addEventListener('click', onModalLibraryClick.bind(null, \"queue\"));\n\nfunction getModalFilmId() {\n  //return refsM.infoId.dataset.filmid;\n  return '5';   // !?! - заглушка, убрать\n}\n\nfunction onModalLibraryClick(libName) {\n  const movieId = getModalFilmId();\n\n  if (!movieId) {\n    return;\n  }\n\n  if (myLibs[libName].getMovieById(movieId)) {\n    myLibs[libName].removeMovie(movieId);\n  } else {\n    const movie = getMovieModal();\n    myLibs[libName].addMovie(movie);\n  }\n\n  page = 1;\n  showLibrary();\n\n  refreshBtns();\n}\n\nfunction refreshBtns() {\n  const movieId = getModalFilmId();\n\n  if (!movieId) {\n    return;\n  }\n\n  if (myLibs.watched.getMovieById(movieId)) {\n    refsM.btnWatched.textContent = 'REMOVE FROM WATCHED';\n    refsM.btnWatched.classList.remove(\"js-active\");\n  } else {\n    refsM.btnWatched.textContent = 'ADD TO WATCHED';\n    refsM.btnWatched.classList.add(\"js-active\");\n  }\n\n  if (myLibs.queue.getMovieById(movieId)) {\n    refsM.btnQueue.textContent = 'REMOVE FROM QUEUE';\n    refsM.btnQueue.classList.remove(\"js-active\");\n  } else {\n    refsM.btnQueue.textContent = 'ADD TO QUEUE';\n    refsM.btnQueue.classList.add(\"js-active\");\n  }\n}\n\nfunction getMovieModal() {\n  const movie = {\n    id: getModalFilmId(),\n    title: refsM.title.textContent,\n    posterURL: refsM.poster.src,\n    overview: refsM.overview.textContent,\n    /* !?! - доделать когда будет разметка\n    genres: 'Drama, Comedy',\n    year: 2022,\n    vote: '5.7',\n    votes: '1234',\n    popularity: '100.2',\n    original: `Avatar: The Way of Water`,\n    */\n  };\n\n  return movie;\n}\n","export default\nfunction createFilmCardMarkup({id, posterURL = '', title = '', genres = 'no info', year = 'no info', votes = '' }) {\n  return ` \n    <div class=\"card\" data-filmid=\"${id}\">\n        <img src=\"${posterURL}\" class=\"card__pic\">\n        <div class=\"card__information\">\n            <p class=\"card__film-name\">${title}</p>\n            <div class=\"card__additional-information\">\n                <ul class=\"card__gener-list\">\n                    <li class=\"card__gener-item\">${genres}</li>\n                </ul>\n                <div class=\"card__vl\"></div>\n                <p class=\"card__release-year\">${year}</p>\n            </div>\n        </div>\n    </div>\n  `;\n}    \n"],"names":["$54T7b","parcelRequire","$80c4189e6cc88ea4$export$2e2bcd8739ae039","id","posterURL","title","genres","year","votes","$93effc6fc56091ad$var$myLib","default","watched","$93effc6fc56091ad$var$page","$93effc6fc56091ad$var$refs","gallery","document","querySelector","btnWatched","btnQueue","Object","values","some","el","Error","$93effc6fc56091ad$var$onBtnLibraryClick","evt","curBtn","currentTarget","queue","classList","add","remove","refreshMovies","$93effc6fc56091ad$var$showLibrary","insertAdjacentHTML","guardDiv","addEventListener","$93effc6fc56091ad$var$observer","IntersectionObserver","entries","observer","forEach","entry","isIntersecting","getCountPages","root","rootMargin","threshold","getCount","innerHTML","movies","getMoviesPage","map","movie","join","$93effc6fc56091ad$var$createGalleryMarkup","observe","unobserve","$93effc6fc56091ad$var$refsM","infoId","poster","overview","$93effc6fc56091ad$var$onModalLibraryClick","libName","getMovieById","removeMovie","textContent","src","addMovie","movieId","$93effc6fc56091ad$var$refreshBtns","bind"],"version":3,"file":"library.39cef152.js.map"}